# Проектирование компонентов системы

### 3.1. Вычислительное ядро (`CalculatorCore`)

Это основа эмулятора, реализованная в виде TypeScript-класса или модуля, не зависящего от фреймворков.

#### Ключевые обязанности:
- Хранение текущего состояния калькулятора (регистры, флаги).
- Реализация всех математических и логических операций.
- Форматирование чисел для отображения на дисплее.

#### Состояние и регистры памяти:
Состояние будет храниться в приватных полях класса. Основу составляют операционные регистры, эмулирующие стек калькулятора.

```typescript
// Примерная структура состояния в CalculatorCore.ts
import Decimal from 'decimal.js';

interface CalculatorState {
  xRegister: Decimal; // Основной рабочий регистр (дисплей)
  yRegister: Decimal; // Второй регистр для операций
  zRegister: Decimal; // Третий регистр стека
  tRegister: Decimal; // Четвертый регистр стека
  
  memoryRegister: Decimal; // Регистр памяти 'П'
  
  isEntering: boolean; // Флаг, указывающий на ввод нового числа
  displayValue: string; // Отформатированная строка для UI
  // ... другие флаги состояния (ошибка, режим и т.д.)
}
```
Операции, такие как "Ввод" (`↑`), будут сдвигать значения по регистрам (T → Z, Z → Y, Y → X), обеспечивая стековую логику.

### 3.2. Система логирования

Логгер будет реализован как отдельный легковесный модуль, который можно будет импортировать в любую часть приложения.

#### Архитектура:
1.  **`Logger.ts`**: Простой модуль с двумя основными функциями:
    *   `logDebug(message: string, data?: object)`: Записывает сообщение в консоль, только если уровень логирования `DEBUG`.
    *   `logError(message: string, error?: Error)`: Всегда записывает ошибку в консоль.

2.  **Конфигурация**: Уровень логирования будет считываться из переменных окружения (`.env` файл).

    ```typescript
    // src/services/Logger.ts
    
    const LOG_LEVEL = process.env.REACT_APP_LOG_LEVEL || 'ERROR';

    export const logDebug = (message: string, data?: object) => {
      if (LOG_LEVEL === 'DEBUG') {
        console.log(`[DEBUG] ${message}`, data || '');
      }
    };
    
    export const logError = (message: string, error?: Error) => {
      console.error(`[ERROR] ${message}`, error || '');
    };
    ```

#### Интеграция:
`CalculatorCore` будет использовать логгер для трассировки выполнения операций.
```typescript
// Пример в CalculatorCore.ts
import { logDebug, logError } from '../services/Logger';

// ... внутри какого-либо метода
public performAddition() {
  logDebug('Performing addition', { 
    x: this.state.xRegister, 
    y: this.state.yRegister 
  });
  // ... логика сложения
}
```

### 3.3. Пользовательский интерфейс (React Components)

*   **`App.tsx`**: Корневой компонент. Инициализирует `CalculatorCore`, управляет состоянием через `useReducer` и передает данные дочерним компонентам.
*   **`Display.tsx`**: Презентационный компонент, который получает отформатированную строку и отображает ее.
*   **`Button.tsx`**: Переиспользуемый компонент кнопки. Принимает `onClick` callback и стили.
*   **`ButtonGrid.tsx`**: Компонент, отвечающий за расположение всех 36 кнопок в правильном порядке.
