# Техническая история: Устранение уязвимостей в зависимостях

- **Статус**: ready for development
- **Эпик**: 1. Основа проекта и пользовательский интерфейс

---

## 1. Описание

**Как** разработчик, **я хочу** обновить зависимости проекта, чтобы устранить критические уязвимости безопасности, **чтобы** обеспечить стабильность и безопасность приложения.

---

## 2. Контекст проблемы

- **Источник:** `docs/qa/gates/1.1-nastrojka-proekta.yml`
- **Проблема:** `npm audit` обнаружил 9 уязвимостей, из которых 6 имеют высокий уровень серьезности. Попытка автоматического исправления (`npm audit fix --force`) ломает сборку проекта (`react-scripts`).

---

## 3. Критерии приемки (AC)

1.  Все уязвимости высокого уровня, о которых сообщает `npm audit`, устранены.
2.  Проект успешно собирается и запускается после обновления зависимостей.
3.  Принято и задокументировано решение о стратегии обновления:
    -   Ручное обновление зависимостей в рамках `Create React App`.
    -   Миграция с `Create React App` на `Vite` или `Next.js`.
4.  Выбранная стратегия успешно реализована.

---

## 4. Задачи / Подзадачи

- [x] **Задача 1:** Провести детальный анализ уязвимостей, о которых сообщает `npm audit`.
- [x] **Задача 2:** Исследовать и сравнить варианты решения: ручное обновление в CRA, переход на Vite, переход на Next.js. Оценить трудозатраты и риски для каждого варианта.
- [x] **Задача 3:** Представить результаты анализа для принятия решения.
- [ ] **Задача 4:** Реализовать выбранную стратегию.
- [ ] **Задача 5:** Провести полное регрессионное тестирование, чтобы убедиться, что обновление не сломало существующий функционал.
- [ ] **Задача 6:** Обновить документацию проекта, если были внесены изменения в стек технологий или процесс сборки.

---

## 5. Анализ и Рекомендация

### 5.1. Результаты `npm audit`

Анализ выявил 9 уязвимостей, из которых 6 имеют высокий уровень критичности. Основные проблемы связаны с пакетами `nth-check`, `postcss` и `webpack-dev-server`, которые являются глубоко вложенными зависимостями `react-scripts`. Попытка автоматического исправления (`npm audit fix --force`) приводит к поломке сборки, так как предлагает несовместимые версии пакетов.

### 5.2. Коренная причина

Проблема заключается в архитектуре **Create React App (CRA)** и его основного пакета `react-scripts`. CRA инкапсулирует все конфигурации и зависимости в один пакет с жестко заданными версиями. Это упрощает первоначальную настройку, но делает проект негибким и уязвимым, когда вложенные зависимости устаревают или получают уязвимости. Мы не можем обновить их напрямую, не сломав `react-scripts`.

Любые попытки ручного исправления зависимостей в рамках CRA являются временными и не решают системную проблему. Уязвимости будут появляться снова, и команда будет тратить время на их устранение вместо разработки продукта.

Таким образом, **миграция со сборщика CRA является единственным надежным и долгосрочным решением** для обеспечения безопасности и стабильности проекта.

### 5.4. Утвержденное решение: Миграция на Vite

**Принято окончательное решение о миграции проекта на Vite.**

Это наиболее стратегически верный шаг, который не только устранит текущие уязвимости, но и предотвратит их системное появление в будущем. Vite обеспечит проекту современный, быстрый и гибкий инструментарий для сборки, что положительно скажется на скорости и удобстве дальнейшей разработки. Все альтернативные пути признаны временными и нецелесообразными.
